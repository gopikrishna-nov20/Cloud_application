version: 2.1

jobs:
  terraform:
    docker:
      - image: cimg/ubuntu:latest
    steps:
      - checkout
      - run: zip lambda.zip index.js
      - run: apt-get update && apt-get install -y terraform
      - run: terraform init
      - run: terraform plan
      - run: terraform apply -auto-approve

workflows:
  version: 2.1
  terraform:
    jobs:
      - terraform

environment:
  AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
  AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}